<!DOCTYPE html>
<html>
<!--
    Exchange the line above for this to enable offline support
    <html manifest="manifest.appcache">

    Please make your homework before doing this:
        http://www.alistapart.com/articles/application-cache-is-a-douchebag/
        http://appcachefacts.info

    This might be necessary to set up on your server, to make sure
    files are updated when the appcache file itself is:
        https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/.htaccess
 -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- <link rel="stylesheet" type="text/css" href="css/base.css"> -->
    <!-- <link rel="stylesheet" type="text/css" href="css/headers.css"> -->
    <!-- <link rel="stylesheet" type="text/css" href="css/buttons.css"> -->
    <!-- <link rel="stylesheet" type="text/css" href="css/toolbars.css"> -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link href="http://code.jquery.com/ui/1.8.21/themes/base/jquery-ui.css" rel="stylesheet">
    <link href="http://code.jquery.com/ui/1.8.21/themes/ui-lightness/jquery-ui.css" rel="stylesheet">

    <script src="js/jquery-1.7.2.min.js"></script>
    <!-- <script src="js/jquery-ui.min.js"></script> -->
    <!-- prerequisites -->
    <!-- <script src="js/jquery.ui.touch-punch.min.js"></script> -->
    <!-- <script src="js/jquery.touchy.min.js"></script> -->

    <script type="text/javascript" src="js/app.js"></script>

    <!-- <script src="js/jquery.ui.rotatable.js"></script> -->

    <script src="js/hammer.js"></script>
    <script src="js/jquery.hammer.js"></script>
    <script src="js/myLogic.js"></script>

    <!-- this is small and will allow you to override look/feel of handle -->
    <!-- <link rel="stylesheet" href="css/jquery.ui.rotatable.css"> -->
    <link href='css/hammer-style.css' rel='stylesheet' type='text/css'>

    <title>Sticky</title>

    <script type="text/javascript" charset="utf-8">

      $(document).ready(function() {

          //get rotation degrees
          function getRotationDegrees(obj) {
              var matrix = obj.css("-webkit-transform") ||
              obj.css("-moz-transform")    ||
              obj.css("-ms-transform")     ||
              obj.css("-o-transform")      ||
              obj.css("transform");
              if(matrix !== 'none') {
                  var values = matrix.split('(')[1].split(')')[0].split(',');
                  var a = values[0];
                  var b = values[1];
                  var angle = Math.round(Math.atan2(b, a) * (180/Math.PI));
              } else { var angle = 0; }
              return (angle < 0) ? angle +=360 : angle;
          }

          // intro screen
          $("#intro-screen").click(function(){
            $("#intro-screen").fadeOut(300);
          })
          // end intro screen

          var d_canvas = document.getElementById('canvas');
          var context = d_canvas.getContext('2d');
          var sticker = document.getElementById('newimage');

          d_canvas.width  = 324;
          d_canvas.height = 520;
          d_canvas.style.width  = '324px';
          d_canvas.style.height = '520px';
          var currentScale;
          var newleftsideside;
          var newtopsideside;
          var newWidth;
          var newHeight;

          $("#newimage").hide();

          $('.btn-place').click(function() {

              $(".overlay").remove();
              $( "#done-panel" ).animate({
                  bottom: "-300"
              }, 200);

              var $sticker = $("#newimage"),
                  $canvas = $('#canvas');

              var sticker_x = $sticker.offset().left - $canvas.offset().left,
                  sticker_y = $sticker.offset().top - $canvas.offset().top;

              var leftside = $("#zoom").css("left");
              var topside = $("#zoom").css("top");
              var newleftside = parseInt(leftside);
              var newtopside = parseInt(topside);
              var attr = $('.polaroid').attr('style');

              if (typeof attr !== 'undefined' && attr !== false) {
                //alert("has style attr");
                //scaled
                function matrixToArray(matrix) {
                    return matrix.substr(7, matrix.length - 8).split(', ');
                }
                matrix = matrixToArray($(".polaroid").css("transform"));
                currentScale = matrix[3];
                newWidth = 100 * currentScale;
                newHeight = 100 * currentScale;
                newleftsideside = newleftside + parseInt($(".leftside").html());
                newtopsideside = newtopside + parseInt($(".topside").html());
                context.drawImage(sticker, newleftsideside, newtopsideside, newWidth, newHeight);
                $sticker.hide();
              }

              else {
                //alert("does not have style attr");
                currentScale = 1;
                newWidth = 100 * currentScale;
                newHeight = 100 * currentScale;
                newleftsideside = parseInt(sticker_x);
                newtopsideside = parseInt(sticker_y);
                context.drawImage(sticker, newleftsideside, newtopsideside, newWidth, newHeight);
                $sticker.hide();
              }


          });

      });
    </script>

</head>

<body>

    <div class="leftside">leftside</div>
    <div class="topside">topside</div>

    <div id="intro-screen" class="page">
      <div class="main-text">
            <h1>Sticky</h1>
            <p>Tap to start!</p>
      </div>
    </div>

    <div id="canvas-area" class="page">

      <div id="zoom" class="zoomProps" >
          <div class="polaroid">
              <img src="images/stickers/fox-mask.png" alt="" width="100" height="100" id="newimage"/>
          </div>
      </div>

      <canvas id="canvas"></canvas>

      <div class="topbarslidedown">
        <div class="row">
            <div class="col-xs-4 text-center"><button class="btn btn-default pull-left btn-place">&#x2714;</button></div>
            <div class="col-xs-4 text-center">Place the sticker!</div>
            <div class="col-xs-4 text-center"><button class="btn btn-default pull-right btn-remove">&#x2718;</button></div>
        </div>
      </div>

      <div class="bottom-bar">
        <div class="row">
            <div class="col-xs-4 text-center"><button class="btn btn-default pick-from-lib-btn">New</button></div>
            <div class="col-xs-4 text-center"><button class="btn btn-primary stickers-btn">Stickers</button></div>
            <div class="col-xs-4 text-center"><button class="btn btn-default done-btn">Done</button></div>
        </div>
      </div>
    </div>




    <div id="done-panel" class="panel panel-default">
      <div class="panel-body">
        <button type="button" class="btn btn-primary btn-lg btn-block" id="save-btn" >Save to Gallery</button>
        <button type="button" class="btn btn-default btn-lg btn-block" id="btn-clear">Clear All</button>
        <button type="button" class="btn btn-default btn-lg btn-block" id="btn-cancel" href="">Cancel</button>
      </div>
    </div>

    <div id="stickers-screen" class="page">
      <!-- stickers go here and slideup/down-->
      <div class="top-bar">
        Choose a sticker!
        <button class="btn btn-primary close-btn pull-right">Close</button>
      </div>
      <div class="main-section">
        <div class="row">
          <div class="col-xs-4">
            <div class="sticker sticker-1">
              <img src="images/stickers/fox-mask.png" style="width: 100%; height: 100%;" />
            </div>
          </div>
          <div class="col-xs-4">
            <div class="sticker sticker-2">
              <img src="images/stickers/sunglasses.png" style="width: 100%; height: 100%;" />
            </div>
          </div>
          <div class="col-xs-4">
            <div class="sticker sticker-3">
              <img src="images/stickers/mustache.png" style="width: 100%; height: 100%;" />
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <div class="sticker sticker-4">
              <img src="images/stickers/hat.png" style="width: 100%; height: 100%;" />
            </div>
          </div>
          <div class="col-xs-4">
            <div class="sticker sticker-5">
              <img src="images/stickers/nose.png" style="width: 100%; height: 100%;" />
            </div>
          </div>
          <div class="col-xs-4">
            <div class="sticker sticker-6">
              <img src="images/stickers/tail.png" style="width: 100%; height: 100%;" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="js/base.js"></script>
    <script type="text/javascript" src="js/webapp.js"></script>
    <script type="text/javascript" src="js/offline.js"></script>
    <!-- <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script> -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

    <script type="text/javascript" src="js/moveSticker.js"></script>


    <!--
        Loosely based on fxosstub: https://github.com/Jaxo/fxosstub
    -->

</body>
</html>
